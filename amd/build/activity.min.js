define("mod_tutoom/activity",["exports","core/templates","core/notification"],(function(_exports,_templates,_notification){var obj;function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj},M.mod_tutoom=M.mod_tutoom||{};_exports.init=function(ID,isModerator,baseUrl){var _ref,contentContainer=document.getElementById("tutoom-content-box"),spinnerHTML="<div class='spinner-border spinner-border-sm text-dark'></div>",ACTIONS_GET_MEETING="get_meeting",ACTIONS_START_MEETING="start_meeting",ACTIONS_JOIN_MEETING="join_meeting",ACTIONS_END_MEETING="end_meeting",getMeeting=(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var url;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return url="".concat(baseUrl,"?action=").concat(ACTIONS_GET_MEETING,"&sesskey=").concat(M.cfg.sesskey,"&id=").concat(ID),_context.next=3,window.fetch(url);case 3:return _context.abrupt("return",_context.sent);case 4:case"end":return _context.stop()}}),_callee)}))),function(){return _ref.apply(this,arguments)});document.addEventListener("click",(function(e){var elementId=e.target.id;elementId&&("tutoom-start-button"===elementId&&startMeeting(e),"tutoom-end-button"===elementId&&endMeeting(e),"tutoom-join-button"===elementId&&joinMeeting(e))}));var _ref2,_ref4,_ref5,startMeeting=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(e){var el,widthButton,lastHTML,url,fetch,response,error,id,res,_yield$res$json,creationTimestamp,participantsCount,meetingDate;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return e.preventDefault(),el=document.getElementById("tutoom-start-button"),widthButton=el.offsetWidth,lastHTML=el.innerHTML,el.style.width="".concat(widthButton,"px"),el.innerHTML=spinnerHTML,_context2.prev=6,url="".concat(baseUrl,"?action=").concat(ACTIONS_START_MEETING,"&sesskey=").concat(M.cfg.sesskey,"&id=").concat(ID,"&logoutUrl=").concat(window.location.href),_context2.next=10,window.fetch(url);case 10:return fetch=_context2.sent,_context2.next=13,fetch.json();case 13:if(response=_context2.sent,error=response.error,id=response.id,error&&console.error(error),!id){_context2.next=28;break}return _context2.next=19,getMeeting();case 19:return res=_context2.sent,_context2.next=22,res.json();case 22:_yield$res$json=_context2.sent,creationTimestamp=_yield$res$json.creationTimestamp,participantsCount=_yield$res$json.participantsCount,meetingDate=(meetingDate=new Date(1e3*creationTimestamp._seconds)).toLocaleTimeString(navigator.language,{hour:"2-digit",minute:"2-digit"}),_templates.default.renderForPromise("mod_tutoom/main_section",{meetingid:id,role:isModerator,meetingdate:meetingDate,participantscount:"".concat(participantsCount),istextpluralparticipant:participantsCount>1}).then((function(_ref3){var html=_ref3.html,js=_ref3.js;_templates.default.replaceNodeContents(contentContainer,html,js)})).catch((function(error){return(0,_notification.exception)(error)}));case 28:_context2.next=34;break;case 30:_context2.prev=30,_context2.t0=_context2.catch(6),console.error(_context2.t0),el.innerHTML=lastHTML;case 34:case"end":return _context2.stop()}}),_callee2,null,[[6,30]])}))),function(_x){return _ref2.apply(this,arguments)}),joinMeeting=(_ref4=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(e){var el,widthButton,lastHTML,url,fetch,response;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return e.preventDefault(),el=document.getElementById("tutoom-join-button"),widthButton=el.offsetWidth,lastHTML=el.innerHTML,el.style.width="".concat(widthButton,"px"),el.innerHTML=spinnerHTML,_context3.prev=6,url="".concat(baseUrl,"?action=").concat(ACTIONS_JOIN_MEETING,"&sesskey=").concat(M.cfg.sesskey,"&id=").concat(ID),_context3.next=10,window.fetch(url);case 10:return fetch=_context3.sent,_context3.next=13,fetch.json();case 13:response=_context3.sent,window.location.href=response,_context3.next=20;break;case 17:_context3.prev=17,_context3.t0=_context3.catch(6),console.error(_context3.t0);case 20:return _context3.prev=20,el.innerHTML=lastHTML,_context3.finish(20);case 23:case"end":return _context3.stop()}}),_callee3,null,[[6,17,20,23]])}))),function(_x2){return _ref4.apply(this,arguments)}),endMeeting=(_ref5=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(e){var value,el,widthButton,lastHTML,url,fetch,response,error,deleted;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return e.preventDefault(),value=e.target.value,el=document.getElementById("tutoom-end-button"),widthButton=el.offsetWidth,lastHTML=el.innerHTML,el.style.width="".concat(widthButton,"px"),el.innerHTML="<div class='spinner-border spinner-border-sm text-danger'></div>",_context4.prev=7,url="".concat(baseUrl,"?action=").concat(ACTIONS_END_MEETING,"&sesskey=").concat(M.cfg.sesskey,"&id=").concat(ID,"&meetingId=").concat(value),_context4.next=11,window.fetch(url);case 11:return fetch=_context4.sent,_context4.next=14,fetch.json();case 14:response=_context4.sent,error=response.error,deleted=response.deleted,error&&console.error(error),deleted&&_templates.default.renderForPromise("mod_tutoom/main_section",{meetingid:null,role:isModerator}).then((function(_ref6){var html=_ref6.html,js=_ref6.js;_templates.default.replaceNodeContents(contentContainer,html,js)})).catch((function(error){return(0,_notification.exception)(error)})),_context4.next=23;break;case 20:_context4.prev=20,_context4.t0=_context4.catch(7),console.error(_context4.t0);case 23:return _context4.prev=23,el.innerHTML=lastHTML,_context4.finish(23);case 26:case"end":return _context4.stop()}}),_callee4,null,[[7,20,23,26]])}))),function(_x3){return _ref5.apply(this,arguments)})}}));

//# sourceMappingURL=activity.min.js.map