{"version":3,"file":"activity.min.js","sources":["../src/activity.js"],"sourcesContent":["/* eslint-disable */\nimport Templates from \"core/templates\";\nimport { exception as displayException } from \"core/notification\";\n\nM.mod_tutoom = M.mod_tutoom || {};\n\nexport const init = (ID, isModerator, requestUri) => {\n  const baseUrl = `${requestUri.split(\"view.php\")[0]}tutoom_ajax.php`;\n\n  const contentContainer = document.getElementById(\"tutoom-content-box\");\n  const spinnerHTML =\n    \"<div class='spinner-border spinner-border-sm text-dark'></div>\";\n\n  const ACTIONS = {\n    GET_MEETING: \"get_meeting\",\n    START_MEETING: \"start_meeting\",\n    JOIN_MEETING: \"join_meeting\",\n    END_MEETING: \"end_meeting\",\n    GET_RECORDINGS: \"get_recordings\",\n  };\n\n  const getMeeting = async () => {\n    const url = `${baseUrl}?action=${ACTIONS.GET_MEETING}&sesskey=${M.cfg.sesskey}&id=${ID}`;\n    return await window.fetch(url);\n  };\n\n  document.addEventListener(\"click\", (e) => {\n    const elementId = e.target.id;\n    if (!elementId) return;\n\n    if (elementId === \"tutoom-start-button\") startMeeting(e);\n    if (elementId === \"tutoom-end-button\") endMeeting(e);\n    if (elementId === \"tutoom-join-button\") joinMeeting(e);\n  });\n\n  const startMeeting = async (e) => {\n    e.preventDefault();\n\n    const el = document.getElementById(\"tutoom-start-button\");\n    const widthButton = el.offsetWidth;\n    const lastHTML = el.innerHTML;\n\n    el.style.width = `${widthButton}px`;\n    el.innerHTML = spinnerHTML;\n\n    try {\n      const url = `${baseUrl}?action=${ACTIONS.START_MEETING}&sesskey=${M.cfg.sesskey}&id=${ID}&logoutUrl=${window.location.href}`;\n      const fetch = await window.fetch(url);\n      const response = await fetch.json();\n\n      const { error, id } = response;\n\n      if (error) {\n        console.error(error);\n      }\n\n      if (id) {\n        const res = await getMeeting();\n        const { creationTimestamp, participantsCount } = await res.json();\n\n        let meetingDate = new Date(creationTimestamp._seconds * 1000);\n        meetingDate = meetingDate.toLocaleTimeString(navigator.language, {\n          hour: \"2-digit\",\n          minute: \"2-digit\",\n        });\n\n        Templates.renderForPromise(\"mod_tutoom/main_section\", {\n          meetingid: id,\n          role: isModerator,\n          meetingdate: meetingDate,\n          participantscount: `${participantsCount}`,\n          istextpluralparticipant: participantsCount > 1,\n        })\n          .then(({ html, js }) => {\n            Templates.replaceNodeContents(contentContainer, html, js);\n          })\n          .catch((error) => displayException(error));\n      }\n    } catch (error) {\n      console.error(error);\n      el.innerHTML = lastHTML;\n    }\n  };\n\n  const joinMeeting = async (e) => {\n    e.preventDefault();\n\n    const el = document.getElementById(\"tutoom-join-button\");\n    const widthButton = el.offsetWidth;\n    const lastHTML = el.innerHTML;\n\n    el.style.width = `${widthButton}px`;\n    el.innerHTML = spinnerHTML;\n\n    try {\n      const url = `${baseUrl}?action=${ACTIONS.JOIN_MEETING}&sesskey=${M.cfg.sesskey}&id=${ID}`;\n      const fetch = await window.fetch(url);\n      const response = await fetch.json();\n      window.location.href = response;\n    } catch (error) {\n      console.error(error);\n    } finally {\n      el.innerHTML = lastHTML;\n    }\n  };\n\n  const endMeeting = async (e) => {\n    e.preventDefault();\n\n    const value = e.target.value;\n\n    const el = document.getElementById(\"tutoom-end-button\");\n    const widthButton = el.offsetWidth;\n    const lastHTML = el.innerHTML;\n\n    el.style.width = `${widthButton}px`;\n    el.innerHTML = `<div class='spinner-border spinner-border-sm text-danger'></div>`;\n\n    try {\n      const url = `${baseUrl}?action=${ACTIONS.END_MEETING}&sesskey=${M.cfg.sesskey}&id=${ID}&meetingId=${value}`;\n      const fetch = await window.fetch(url);\n      const response = await fetch.json();\n\n      const { error, deleted } = response;\n\n      if (error) {\n        console.error(error);\n      }\n\n      if (deleted) {\n        Templates.renderForPromise(\"mod_tutoom/main_section\", {\n          meetingid: null,\n          role: isModerator,\n        })\n          .then(({ html, js }) => {\n            Templates.replaceNodeContents(contentContainer, html, js);\n          })\n          .catch((error) => displayException(error));\n      }\n    } catch (error) {\n      console.error(error);\n    } finally {\n      el.innerHTML = lastHTML;\n    }\n  };\n};\n"],"names":["M","mod_tutoom","ID","isModerator","requestUri","baseUrl","split","contentContainer","document","getElementById","spinnerHTML","ACTIONS","getMeeting","url","cfg","sesskey","window","fetch","addEventListener","e","elementId","target","id","startMeeting","endMeeting","joinMeeting","preventDefault","el","widthButton","offsetWidth","lastHTML","innerHTML","style","width","location","href","json","response","error","console","res","creationTimestamp","participantsCount","meetingDate","Date","_seconds","toLocaleTimeString","navigator","language","hour","minute","renderForPromise","meetingid","role","meetingdate","participantscount","istextpluralparticipant","then","html","js","replaceNodeContents","catch","value","deleted"],"mappings":"8zBAIAA,EAAEC,WAAaD,EAAEC,YAAc,iBAEX,SAACC,GAAIC,YAAaC,qBAC9BC,kBAAaD,WAAWE,MAAM,YAAY,sBAE1CC,iBAAmBC,SAASC,eAAe,sBAC3CC,YACJ,iEAEIC,oBACS,cADTA,sBAEW,gBAFXA,qBAGU,eAHVA,oBAIS,cAITC,4DAAa,uIACXC,cAASR,2BAAkBM,wCAA+BX,EAAEc,IAAIC,uBAAcb,oBACvEc,OAAOC,MAAMJ,kKAG5BL,SAASU,iBAAiB,SAAS,SAACC,OAC5BC,UAAYD,EAAEE,OAAOC,GACtBF,YAEa,wBAAdA,WAAqCG,aAAaJ,GACpC,sBAAdC,WAAmCI,WAAWL,GAChC,uBAAdC,WAAoCK,YAAYN,6BAGhDI,+DAAe,kBAAOJ,8OAC1BA,EAAEO,iBAEIC,GAAKnB,SAASC,eAAe,uBAC7BmB,YAAcD,GAAGE,YACjBC,SAAWH,GAAGI,UAEpBJ,GAAGK,MAAMC,gBAAWL,kBACpBD,GAAGI,UAAYrB,6BAGPG,cAASR,2BAAkBM,0CAAiCX,EAAEc,IAAIC,uBAAcb,yBAAgBc,OAAOkB,SAASC,wBAClGnB,OAAOC,MAAMJ,oBAA3BI,uCACiBA,MAAMmB,kBAAvBC,wBAEEC,MAAcD,SAAdC,MAAOhB,GAAOe,SAAPf,GAEXgB,OACFC,QAAQD,MAAMA,QAGZhB,qDACgBV,4BAAZ4B,qCACiDA,IAAIJ,8CAAnDK,kCAAAA,kBAAmBC,kCAAAA,kBAG3BC,aADIA,YAAc,IAAIC,KAAkC,IAA7BH,kBAAkBI,WACnBC,mBAAmBC,UAAUC,SAAU,CAC/DC,KAAM,UACNC,OAAQ,+BAGAC,iBAAiB,0BAA2B,CACpDC,UAAW9B,GACX+B,KAAMlD,YACNmD,YAAaX,YACbY,4BAAsBb,mBACtBc,wBAAyBd,kBAAoB,IAE5Ce,MAAK,oBAAGC,WAAAA,KAAMC,SAAAA,sBACHC,oBAAoBrD,iBAAkBmD,KAAMC,OAEvDE,OAAM,SAACvB,cAAU,2BAAiBA,oGAGvCC,QAAQD,oBACRX,GAAGI,UAAYD,oIAIbL,8DAAc,kBAAON,iKACzBA,EAAEO,iBAEIC,GAAKnB,SAASC,eAAe,sBAC7BmB,YAAcD,GAAGE,YACjBC,SAAWH,GAAGI,UAEpBJ,GAAGK,MAAMC,gBAAWL,kBACpBD,GAAGI,UAAYrB,6BAGPG,cAASR,2BAAkBM,yCAAgCX,EAAEc,IAAIC,uBAAcb,sBACjEc,OAAOC,MAAMJ,oBAA3BI,uCACiBA,MAAMmB,eAAvBC,wBACNrB,OAAOkB,SAASC,KAAOE,2FAEvBE,QAAQD,qDAERX,GAAGI,UAAYD,gKAIbN,6DAAa,kBAAOL,qLACxBA,EAAEO,iBAEIoC,MAAQ3C,EAAEE,OAAOyC,MAEjBnC,GAAKnB,SAASC,eAAe,qBAC7BmB,YAAcD,GAAGE,YACjBC,SAAWH,GAAGI,UAEpBJ,GAAGK,MAAMC,gBAAWL,kBACpBD,GAAGI,8FAGKlB,cAASR,2BAAkBM,wCAA+BX,EAAEc,IAAIC,uBAAcb,yBAAgB4D,yBAChF9C,OAAOC,MAAMJ,oBAA3BI,uCACiBA,MAAMmB,eAAvBC,wBAEEC,MAAmBD,SAAnBC,MAAOyB,QAAY1B,SAAZ0B,QAEXzB,OACFC,QAAQD,MAAMA,OAGZyB,4BACQZ,iBAAiB,0BAA2B,CACpDC,UAAW,KACXC,KAAMlD,cAELsD,MAAK,oBAAGC,WAAAA,KAAMC,SAAAA,sBACHC,oBAAoBrD,iBAAkBmD,KAAMC,OAEvDE,OAAM,SAACvB,cAAU,2BAAiBA,4FAGvCC,QAAQD,qDAERX,GAAGI,UAAYD"}