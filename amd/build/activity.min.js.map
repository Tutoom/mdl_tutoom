{"version":3,"file":"activity.min.js","sources":["../src/activity.js"],"sourcesContent":["/* eslint-disable */\nimport Templates from \"core/templates\";\nimport { exception as displayException } from \"core/notification\";\n\nM.mod_tutoom = M.mod_tutoom || {};\n\nexport const init = (ID, isModerator, baseUrl) => {\n  const contentContainer = document.getElementById(\"tutoom-content-box\");\n  const spinnerHTML =\n    \"<div class='spinner-border spinner-border-sm text-dark'></div>\";\n\n  const ACTIONS = {\n    GET_MEETING: \"get_meeting\",\n    START_MEETING: \"start_meeting\",\n    JOIN_MEETING: \"join_meeting\",\n    END_MEETING: \"end_meeting\",\n    GET_RECORDINGS: \"get_recordings\",\n  };\n\n  const getMeeting = async () => {\n    const url = `${baseUrl}?action=${ACTIONS.GET_MEETING}&sesskey=${M.cfg.sesskey}&id=${ID}`;\n    return await window.fetch(url);\n  };\n\n  const render = (location, data) => {\n    Templates.renderForPromise(location, data)\n      .then(({ html, js }) => {\n        Templates.replaceNodeContents(contentContainer, html, js);\n      })\n      .catch((error) => displayException(error));\n  };\n\n  document.addEventListener(\"click\", (e) => {\n    const elementId = e.target.id;\n    if (!elementId) return;\n\n    if (elementId === \"tutoom-start-button\") startMeeting(e);\n    if (elementId === \"tutoom-end-button\") endMeeting(e);\n    if (elementId === \"tutoom-join-button\") joinMeeting(e);\n  });\n\n  const startMeeting = async (e) => {\n    e.preventDefault();\n\n    const el = document.getElementById(\"tutoom-start-button\");\n    const widthButton = el.offsetWidth;\n    const lastHTML = el.innerHTML;\n\n    el.style.width = `${widthButton}px`;\n    el.innerHTML = spinnerHTML;\n\n    try {\n      const url = `${baseUrl}?action=${ACTIONS.START_MEETING}&sesskey=${M.cfg.sesskey}&id=${ID}&logoutUrl=${window.location.href}`;\n      const fetch = await window.fetch(url);\n      const response = await fetch.json();\n\n      const { error, id } = response;\n\n      if (error) render(\"mod_tutoom/view_page\", { errorcode: error.errorCode });\n\n      if (id) {\n        const res = await getMeeting();\n        const { creationTimestamp, participantsCount } = await res.json();\n\n        let meetingDate = new Date(creationTimestamp._seconds * 1000);\n        meetingDate = meetingDate.toLocaleTimeString(navigator.language, {\n          hour: \"2-digit\",\n          minute: \"2-digit\",\n        });\n\n        const data = {\n          meetingid: id,\n          ismoderator: isModerator,\n          meetingdate: meetingDate,\n          participantscount: `${participantsCount}`,\n          istextpluralparticipant: participantsCount > 1,\n        };\n\n        render(\"mod_tutoom/main_section\", data);\n      }\n    } catch (error) {\n      console.error(error);\n      el.innerHTML = lastHTML;\n    }\n  };\n\n  const joinMeeting = async (e) => {\n    e.preventDefault();\n\n    const el = document.getElementById(\"tutoom-join-button\");\n    const widthButton = el.offsetWidth;\n    const lastHTML = el.innerHTML;\n\n    el.style.width = `${widthButton}px`;\n    el.innerHTML = spinnerHTML;\n\n    try {\n      const url = `${baseUrl}?action=${ACTIONS.JOIN_MEETING}&sesskey=${M.cfg.sesskey}&id=${ID}`;\n      const fetch = await window.fetch(url);\n      const response = await fetch.json();\n      window.location.href = response;\n    } catch (error) {\n      console.error(error);\n    } finally {\n      el.innerHTML = lastHTML;\n    }\n  };\n\n  const endMeeting = async (e) => {\n    e.preventDefault();\n\n    const value = e.target.value;\n\n    const el = document.getElementById(\"tutoom-end-button\");\n    const widthButton = el.offsetWidth;\n    const lastHTML = el.innerHTML;\n\n    el.style.width = `${widthButton}px`;\n    el.innerHTML = `<div class='spinner-border spinner-border-sm text-danger'></div>`;\n\n    try {\n      const url = `${baseUrl}?action=${ACTIONS.END_MEETING}&sesskey=${M.cfg.sesskey}&id=${ID}&meetingId=${value}`;\n      const fetch = await window.fetch(url);\n      const response = await fetch.json();\n\n      const { error, deleted } = response;\n\n      if (error) {\n        console.error(error);\n      }\n\n      if (deleted) {\n        render(\"mod_tutoom/main_section\", {\n          meetingid: null,\n          ismoderator: isModerator,\n        });\n      }\n    } catch (error) {\n      console.error(error);\n    } finally {\n      el.innerHTML = lastHTML;\n    }\n  };\n};\n"],"names":["M","mod_tutoom","ID","isModerator","baseUrl","contentContainer","document","getElementById","spinnerHTML","ACTIONS","getMeeting","url","cfg","sesskey","window","fetch","render","location","data","renderForPromise","then","html","js","replaceNodeContents","catch","error","addEventListener","e","elementId","target","id","startMeeting","endMeeting","joinMeeting","preventDefault","el","widthButton","offsetWidth","lastHTML","innerHTML","style","width","href","json","response","errorcode","errorCode","res","creationTimestamp","participantsCount","meetingDate","Date","_seconds","toLocaleTimeString","navigator","language","hour","minute","meetingid","ismoderator","meetingdate","participantscount","istextpluralparticipant","console","value","deleted"],"mappings":"8zBAIAA,EAAEC,WAAaD,EAAEC,YAAc,iBAEX,SAACC,GAAIC,YAAaC,kBAC9BC,iBAAmBC,SAASC,eAAe,sBAC3CC,YACJ,iEAEIC,oBACS,cADTA,sBAEW,gBAFXA,qBAGU,eAHVA,oBAIS,cAITC,4DAAa,uIACXC,cAASP,2BAAkBK,wCAA+BT,EAAEY,IAAIC,uBAAcX,oBACvEY,OAAOC,MAAMJ,kKAGtBK,OAAS,SAACC,SAAUC,yBACdC,iBAAiBF,SAAUC,MAClCE,MAAK,oBAAGC,WAAAA,KAAMC,SAAAA,sBACHC,oBAAoBlB,iBAAkBgB,KAAMC,OAEvDE,OAAM,SAACC,cAAU,2BAAiBA,WAGvCnB,SAASoB,iBAAiB,SAAS,SAACC,OAC5BC,UAAYD,EAAEE,OAAOC,GACtBF,YAEa,wBAAdA,WAAqCG,aAAaJ,GACpC,sBAAdC,WAAmCI,WAAWL,GAChC,uBAAdC,WAAoCK,YAAYN,6BAGhDI,+DAAe,kBAAOJ,mPAC1BA,EAAEO,iBAEIC,GAAK7B,SAASC,eAAe,uBAC7B6B,YAAcD,GAAGE,YACjBC,SAAWH,GAAGI,UAEpBJ,GAAGK,MAAMC,gBAAWL,kBACpBD,GAAGI,UAAY/B,6BAGPG,cAASP,2BAAkBK,0CAAiCT,EAAEY,IAAIC,uBAAcX,yBAAgBY,OAAOG,SAASyB,wBAClG5B,OAAOC,MAAMJ,oBAA3BI,uCACiBA,MAAM4B,kBAAvBC,wBAEEnB,MAAcmB,SAAdnB,MAAOK,GAAOc,SAAPd,GAEXL,OAAOT,OAAO,uBAAwB,CAAE6B,UAAWpB,MAAMqB,aAEzDhB,qDACgBpB,4BAAZqC,qCACiDA,IAAIJ,8CAAnDK,kCAAAA,kBAAmBC,kCAAAA,kBAG3BC,aADIA,YAAc,IAAIC,KAAkC,IAA7BH,kBAAkBI,WACnBC,mBAAmBC,UAAUC,SAAU,CAC/DC,KAAM,UACNC,OAAQ,YAGJvC,KAAO,CACXwC,UAAW5B,GACX6B,YAAaxD,YACbyD,YAAaV,YACbW,4BAAsBZ,mBACtBa,wBAAyBb,kBAAoB,GAG/CjC,OAAO,0BAA2BE,gGAGpC6C,QAAQtC,oBACRU,GAAGI,UAAYD,oIAIbL,8DAAc,kBAAON,iKACzBA,EAAEO,iBAEIC,GAAK7B,SAASC,eAAe,sBAC7B6B,YAAcD,GAAGE,YACjBC,SAAWH,GAAGI,UAEpBJ,GAAGK,MAAMC,gBAAWL,kBACpBD,GAAGI,UAAY/B,6BAGPG,cAASP,2BAAkBK,yCAAgCT,EAAEY,IAAIC,uBAAcX,sBACjEY,OAAOC,MAAMJ,oBAA3BI,uCACiBA,MAAM4B,eAAvBC,wBACN9B,OAAOG,SAASyB,KAAOE,2FAEvBmB,QAAQtC,qDAERU,GAAGI,UAAYD,gKAIbN,6DAAa,kBAAOL,qLACxBA,EAAEO,iBAEI8B,MAAQrC,EAAEE,OAAOmC,MAEjB7B,GAAK7B,SAASC,eAAe,qBAC7B6B,YAAcD,GAAGE,YACjBC,SAAWH,GAAGI,UAEpBJ,GAAGK,MAAMC,gBAAWL,kBACpBD,GAAGI,8FAGK5B,cAASP,2BAAkBK,wCAA+BT,EAAEY,IAAIC,uBAAcX,yBAAgB8D,yBAChFlD,OAAOC,MAAMJ,oBAA3BI,uCACiBA,MAAM4B,eAAvBC,wBAEEnB,MAAmBmB,SAAnBnB,MAAOwC,QAAYrB,SAAZqB,QAEXxC,OACFsC,QAAQtC,MAAMA,OAGZwC,SACFjD,OAAO,0BAA2B,CAChC0C,UAAW,KACXC,YAAaxD,gGAIjB4D,QAAQtC,qDAERU,GAAGI,UAAYD"}