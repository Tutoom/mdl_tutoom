define("mod_tutoom/recording",["exports","./lib/actions","./lib/template"],(function(_exports,_actions,_template){function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.joinPlayback=_exports.getRecordings=void 0,M.mod_tutoom=M.mod_tutoom||{};var _ref,joinPlayback=(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(e){var tutoom,baseUrl,ID,meetingid,url,fetch,_yield$fetch$json,joinurl;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(e.preventDefault(),(tutoom=window.tutoom)&&void 0!==tutoom){_context.next=4;break}throw new Error("Tutoom data is empty");case 4:return baseUrl=tutoom.baseUrl,ID=tutoom.id,meetingid=e.target.dataset.meetingid,_context.prev=6,url="".concat(baseUrl,"?action=").concat(_actions.ACTIONS_AJAX_RECORDING.JOIN_PLAYBACK,"&sesskey=").concat(M.cfg.sesskey,"&id=").concat(ID,"&meetingId=").concat(meetingid),_context.next=10,window.fetch(url);case 10:return fetch=_context.sent,_context.next=13,fetch.json();case 13:_yield$fetch$json=_context.sent,joinurl=_yield$fetch$json.joinurl,window.location.href=joinurl,_context.next=21;break;case 18:_context.prev=18,_context.t0=_context.catch(6),console.error(_context.t0);case 21:case"end":return _context.stop()}}),_callee,null,[[6,18]])}))),function(_x){return _ref.apply(this,arguments)});_exports.joinPlayback=joinPlayback;var _ref3,getRecordings=(_ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(_ref2){var _ref2$page,page,_ref2$isFirstTime,isFirstTime,tutoom,baseUrl,ID,countRecordings,limitRecordings,elementRecordingTableContent,elementRecordingLoader,url,fetch,_yield$fetch$json2,data,recordings,callbackBeforeRender,callbackAfterRender,totalPages,pages,currentPage,dataPagination;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(_ref2$page=_ref2.page,page=void 0===_ref2$page?1:_ref2$page,_ref2$isFirstTime=_ref2.isFirstTime,isFirstTime=void 0!==_ref2$isFirstTime&&_ref2$isFirstTime,(tutoom=window.tutoom)&&void 0!==tutoom){_context2.next=4;break}throw new Error("Tutoom data is empty");case 4:return baseUrl=tutoom.baseUrl,ID=tutoom.id,countRecordings=tutoom.countRecordings,limitRecordings=tutoom.limitRecordings,elementRecordingTableContent=document.getElementById("tutoom-recordings-table-content"),elementRecordingLoader=document.getElementById("tutoom_view_recordings_loading"),_context2.prev=7,isFirstTime||(elementRecordingTableContent.innerHTML="",elementRecordingLoader.style.display="flex"),url="".concat(baseUrl,"?action=").concat(_actions.ACTIONS_AJAX_RECORDING.GET_RECORDINGS,"&sesskey=").concat(M.cfg.sesskey,"&id=").concat(ID,"&page=").concat(page),_context2.next=12,window.fetch(url);case 12:return fetch=_context2.sent,_context2.next=15,fetch.json();case 15:return _yield$fetch$json2=_context2.sent,data=_yield$fetch$json2.data,recordings=data.map((function(r,index){var renderRowSeparator=!(index===data.length-1),RecordingId=r.RecordingId,Duration=r.Duration,CreationTimestamp=r.CreationTimestamp,MeetingId=r.MeetingId,Thumbnail=r.Thumbnail,language=window.navigator.language,seconds=Duration,hours=Math.floor(seconds/3600),minutes=Math.floor(seconds%3600/60)+"min";return{recordingId:RecordingId,thumbnail:Thumbnail,duration:hours>0?"".concat(hours,"h ").concat(minutes):minutes,date:new Date(CreationTimestamp).toLocaleString(language,{month:"short",day:"numeric",year:"numeric"}),time:new Date(CreationTimestamp).toLocaleString(language,{hour:"numeric",minute:"numeric",hour12:!0}),renderRowSeparator:renderRowSeparator,meetingid:MeetingId}})),callbackBeforeRender=function(){elementRecordingLoader.style.display="none"},callbackAfterRender=function(){document.querySelectorAll(".thumbnail").forEach((function(thumbnail){thumbnail.addEventListener("click",joinPlayback)}))},_context2.next=22,(0,_template.renderTemplate)({data:{recordings:recordings},type:_template.TEMPLATES.RECORDING_TABLE_CONTENT,callbackBeforeRender:callbackBeforeRender,callbackAfterRender:callbackAfterRender});case 22:totalPages=Math.ceil(countRecordings/limitRecordings),pages=_toConsumableArray(Array(totalPages).keys()).map((function(n){return{number:n+1,isSelected:n+1===page}})),currentPage=pages.findIndex((function(p){return p.isSelected}))+1,totalPages>1&&(dataPagination={pages:pages,disablePrevious:1===page,disableNext:page===totalPages,currentPage:currentPage},(0,_template.renderTemplate)({data:dataPagination,type:_template.TEMPLATES.RECORDING_PAGINATION})),_context2.next=31;break;case 28:_context2.prev=28,_context2.t0=_context2.catch(7),console.error(_context2.t0);case 31:case"end":return _context2.stop()}}),_callee2,null,[[7,28]])}))),function(_x2){return _ref3.apply(this,arguments)});_exports.getRecordings=getRecordings}));

//# sourceMappingURL=recording.min.js.map