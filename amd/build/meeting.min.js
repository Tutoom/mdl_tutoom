define("mod_tutoom/meeting",["exports","./lib/actions","./lib/template"],(function(_exports,_actions,_template){function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.startMeeting=_exports.joinMeeting=_exports.getMeeting=_exports.endMeeting=_exports.clearMainSection=void 0,M.mod_tutoom=M.mod_tutoom||{};var _ref,spinnerHTML="<div class='spinner-border spinner-border-sm text-dark'></div>",getMeeting=(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var tutoom,baseUrl,ID,url;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if((tutoom=window.tutoom)&&void 0!==tutoom){_context.next=3;break}throw new Error("Tutoom data is empty");case 3:return baseUrl=tutoom.baseUrl,ID=tutoom.id,url="".concat(baseUrl,"?action=").concat(_actions.ACTIONS_AJAX_MEETING.GET_MEETING,"&sesskey=").concat(M.cfg.sesskey,"&id=").concat(ID),_context.next=7,window.fetch(url);case 7:return _context.abrupt("return",_context.sent);case 8:case"end":return _context.stop()}}),_callee)}))),function(){return _ref.apply(this,arguments)});_exports.getMeeting=getMeeting;var _ref2,startMeeting=(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(e){var tutoom,baseUrl,ID,isModerator,elementButton,widthButton,lastHTML,url,fetch,response,error,id,data,res,_yield$res$json,meetingDate,participantsCount,_data;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(e.preventDefault(),(tutoom=window.tutoom)&&void 0!==tutoom){_context2.next=4;break}throw new Error("Tutoom data is empty");case 4:return baseUrl=tutoom.baseUrl,ID=tutoom.id,isModerator=tutoom.isModerator,elementButton=document.getElementById("tutoom-start-button"),widthButton=elementButton.offsetWidth,lastHTML=elementButton.innerHTML,elementButton.style.width="".concat(widthButton,"px"),elementButton.innerHTML=spinnerHTML,_context2.prev=10,url="".concat(baseUrl,"?action=").concat(_actions.ACTIONS_AJAX_MEETING.START_MEETING,"&sesskey=").concat(M.cfg.sesskey,"&id=").concat(ID,"&logoutUrl=").concat(window.location.href),_context2.next=14,window.fetch(url);case 14:return fetch=_context2.sent,_context2.next=17,fetch.json();case 17:if(response=_context2.sent,error=response.error,id=response.id,error&&(data={error:!0,errorcode:error.errorCode},(0,_template.renderTemplate)({data:data,type:_template.TEMPLATES.MAIN_SECTION})),!id){_context2.next=31;break}return _context2.next=23,getMeeting();case 23:return res=_context2.sent,_context2.next=26,res.json();case 26:_yield$res$json=_context2.sent,meetingDate=_yield$res$json.meetingDate,participantsCount=_yield$res$json.participantsCount,_data={meetingid:id,ismoderator:isModerator,meetingdate:meetingDate,participantscount:"".concat(participantsCount),istextpluralparticipant:participantsCount>1},(0,_template.renderTemplate)({data:_data,type:_template.TEMPLATES.MAIN_SECTION});case 31:_context2.next=37;break;case 33:_context2.prev=33,_context2.t0=_context2.catch(10),console.error(_context2.t0),elementButton.innerHTML=lastHTML;case 37:case"end":return _context2.stop()}}),_callee2,null,[[10,33]])}))),function(_x){return _ref2.apply(this,arguments)});_exports.startMeeting=startMeeting;var _ref3,joinMeeting=(_ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(e){var tutoom,baseUrl,ID,elementButton,widthButton,lastHTML,url,fetch,_yield$fetch$json,joinurl,data;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(e.preventDefault(),(tutoom=window.tutoom)&&void 0!==tutoom){_context3.next=4;break}throw new Error("Tutoom data is empty");case 4:return baseUrl=tutoom.baseUrl,ID=tutoom.id,elementButton=document.getElementById("tutoom-join-button"),widthButton=elementButton.offsetWidth,lastHTML=elementButton.innerHTML,elementButton.style.width="".concat(widthButton,"px"),elementButton.innerHTML=spinnerHTML,_context3.prev=10,url="".concat(baseUrl,"?action=").concat(_actions.ACTIONS_AJAX_MEETING.JOIN_MEETING,"&sesskey=").concat(M.cfg.sesskey,"&id=").concat(ID),_context3.next=14,window.fetch(url);case 14:return fetch=_context3.sent,_context3.next=17,fetch.json();case 17:_yield$fetch$json=_context3.sent,(joinurl=_yield$fetch$json.joinurl)&&null!==joinurl?window.location.href=joinurl:(data={error:!0,meetingidnotexists:!0},(0,_template.renderTemplate)({data:data,type:_template.TEMPLATES.MAIN_SECTION})),_context3.next=25;break;case 22:_context3.prev=22,_context3.t0=_context3.catch(10),console.error(_context3.t0);case 25:return _context3.prev=25,elementButton.innerHTML=lastHTML,_context3.finish(25);case 28:case"end":return _context3.stop()}}),_callee3,null,[[10,22,25,28]])}))),function(_x2){return _ref3.apply(this,arguments)});_exports.joinMeeting=joinMeeting;var _ref4,endMeeting=(_ref4=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(e){var tutoom,baseUrl,ID,elementButton,value,widthButton,lastHTML,url,fetch,response,error,deleted,data;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(e.preventDefault(),(tutoom=window.tutoom)&&void 0!==tutoom){_context4.next=4;break}throw new Error("Tutoom data is empty");case 4:return baseUrl=tutoom.baseUrl,ID=tutoom.id,elementButton=document.getElementById("tutoom-end-button"),value=e.target.value,widthButton=elementButton.offsetWidth,lastHTML=elementButton.innerHTML,elementButton.style.width="".concat(widthButton,"px"),elementButton.innerHTML="<div class='spinner-border spinner-border-sm text-danger'></div>",_context4.prev=11,url="".concat(baseUrl,"?action=").concat(_actions.ACTIONS_AJAX_MEETING.END_MEETING,"&sesskey=").concat(M.cfg.sesskey,"&id=").concat(ID,"&meetingId=").concat(value),_context4.next=15,window.fetch(url);case 15:return fetch=_context4.sent,_context4.next=18,fetch.json();case 18:response=_context4.sent,error=response.error,deleted=response.deleted,error&&(console.error(error),error.meetingidnotexists&&(data={error:!0,meetingidnotexists:!0},(0,_template.renderTemplate)({data:data,type:_template.TEMPLATES.MAIN_SECTION}))),deleted&&clearMainSection(e),_context4.next=27;break;case 24:_context4.prev=24,_context4.t0=_context4.catch(11),console.error(_context4.t0);case 27:return _context4.prev=27,elementButton.innerHTML=lastHTML,_context4.finish(27);case 30:case"end":return _context4.stop()}}),_callee4,null,[[11,24,27,30]])}))),function(_x3){return _ref4.apply(this,arguments)});_exports.endMeeting=endMeeting;var clearMainSection=function(e){e.preventDefault();var tutoom=window.tutoom;if(!tutoom||void 0===tutoom)throw new Error("Tutoom data is empty");var data={meetingid:null,ismoderator:tutoom.isModerator};(0,_template.renderTemplate)({data:data,type:_template.TEMPLATES.MAIN_SECTION})};_exports.clearMainSection=clearMainSection}));

//# sourceMappingURL=meeting.min.js.map