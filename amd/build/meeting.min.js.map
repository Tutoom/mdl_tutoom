{"version":3,"file":"meeting.min.js","sources":["../src/meeting.js"],"sourcesContent":["/* eslint-disable */\nimport { ACTIONS_AJAX_MEETING } from \"./lib/actions\";\nimport { TEMPLATES, renderTemplate } from \"./lib/template\";\n\nM.mod_tutoom = M.mod_tutoom || {};\n\nconst spinnerHTML =\n  \"<div class='spinner-border spinner-border-sm text-dark'></div>\";\n\nexport const getMeeting = async () => {\n  const tutoom = window.tutoom;\n  if (!tutoom || tutoom === undefined) throw new Error(\"Tutoom data is empty\");\n\n  const { baseUrl, id: ID } = tutoom;\n\n  const url = `${baseUrl}?action=${ACTIONS_AJAX_MEETING.GET_MEETING}&sesskey=${M.cfg.sesskey}&id=${ID}`;\n  return await window.fetch(url);\n};\n\nexport const startMeeting = async (e) => {\n  e.preventDefault();\n\n  const tutoom = window.tutoom;\n  if (!tutoom || tutoom === undefined) throw new Error(\"Tutoom data is empty\");\n\n  const { baseUrl, id: ID, isModerator } = tutoom;\n\n  const elementButton = document.getElementById(\"tutoom-start-button\");\n\n  const widthButton = elementButton.offsetWidth;\n  const lastHTML = elementButton.innerHTML;\n\n  elementButton.style.width = `${widthButton}px`;\n  elementButton.innerHTML = spinnerHTML;\n\n  try {\n    const url = `${baseUrl}?action=${ACTIONS_AJAX_MEETING.START_MEETING}&sesskey=${M.cfg.sesskey}&id=${ID}&logoutUrl=${window.location.href}`;\n    const fetch = await window.fetch(url);\n    const response = await fetch.json();\n\n    const { error, id } = response;\n\n    if (error) {\n      const data = { error: true, errorcode: error.errorCode };\n      renderTemplate({ data, type: TEMPLATES.MAIN_SECTION });\n    }\n\n    if (id) {\n      const res = await getMeeting();\n      const { meetingDate, participantsCount } = await res.json();\n\n      const data = {\n        meetingid: id,\n        ismoderator: isModerator,\n        meetingdate: meetingDate,\n        participantscount: `${participantsCount}`,\n        istextpluralparticipant: participantsCount > 1,\n      };\n\n      renderTemplate({ data, type: TEMPLATES.MAIN_SECTION });\n    }\n  } catch (error) {\n    console.error(error);\n    elementButton.innerHTML = lastHTML;\n  }\n};\n\nexport const joinMeeting = async (e) => {\n  e.preventDefault();\n\n  const tutoom = window.tutoom;\n  if (!tutoom || tutoom === undefined) throw new Error(\"Tutoom data is empty\");\n\n  const { baseUrl, id: ID } = tutoom;\n\n  const elementButton = document.getElementById(\"tutoom-join-button\");\n\n  const widthButton = elementButton.offsetWidth;\n  const lastHTML = elementButton.innerHTML;\n\n  elementButton.style.width = `${widthButton}px`;\n  elementButton.innerHTML = spinnerHTML;\n\n  try {\n    const url = `${baseUrl}?action=${ACTIONS_AJAX_MEETING.JOIN_MEETING}&sesskey=${M.cfg.sesskey}&id=${ID}`;\n    const fetch = await window.fetch(url);\n    const { joinurl } = await fetch.json();\n\n    if (!joinurl || joinurl === null) {\n      const data = { error: true, meetingidnotexists: true };\n      renderTemplate({ data, type: TEMPLATES.MAIN_SECTION });\n    } else {\n      window.location.href = joinurl;\n    }\n  } catch (error) {\n    console.error(error);\n  } finally {\n    elementButton.innerHTML = lastHTML;\n  }\n};\n\nexport const endMeeting = async (e) => {\n  e.preventDefault();\n\n  const tutoom = window.tutoom;\n  if (!tutoom || tutoom === undefined) throw new Error(\"Tutoom data is empty\");\n\n  const { baseUrl, id: ID } = tutoom;\n\n  const elementButton = document.getElementById(\"tutoom-end-button\");\n\n  const value = e.target.value;\n  const widthButton = elementButton.offsetWidth;\n  const lastHTML = elementButton.innerHTML;\n\n  elementButton.style.width = `${widthButton}px`;\n  elementButton.innerHTML = `<div class='spinner-border spinner-border-sm text-danger'></div>`;\n\n  try {\n    const url = `${baseUrl}?action=${ACTIONS_AJAX_MEETING.END_MEETING}&sesskey=${M.cfg.sesskey}&id=${ID}&meetingId=${value}`;\n    const fetch = await window.fetch(url);\n    const response = await fetch.json();\n\n    const { error, deleted } = response;\n\n    if (error) {\n      console.error(error);\n\n      if (error.meetingidnotexists) {\n        const data = { error: true, meetingidnotexists: true };\n        renderTemplate({ data, type: TEMPLATES.MAIN_SECTION });\n      }\n    }\n\n    if (deleted) clearMainSection(e);\n  } catch (error) {\n    console.error(error);\n  } finally {\n    elementButton.innerHTML = lastHTML;\n  }\n};\n\nexport const clearMainSection = (e) => {\n  e.preventDefault();\n\n  const tutoom = window.tutoom;\n  if (!tutoom || tutoom === undefined) throw new Error(\"Tutoom data is empty\");\n\n  const { isModerator } = tutoom;\n\n  const data = { meetingid: null, ismoderator: isModerator };\n  renderTemplate({ data, type: TEMPLATES.MAIN_SECTION });\n};\n"],"names":["M","mod_tutoom","spinnerHTML","getMeeting","tutoom","window","undefined","Error","baseUrl","ID","id","url","ACTIONS_AJAX_MEETING","GET_MEETING","cfg","sesskey","fetch","startMeeting","e","preventDefault","isModerator","elementButton","document","getElementById","widthButton","offsetWidth","lastHTML","innerHTML","style","width","START_MEETING","location","href","json","response","error","data","errorcode","errorCode","type","TEMPLATES","MAIN_SECTION","res","meetingDate","participantsCount","meetingid","ismoderator","meetingdate","participantscount","istextpluralparticipant","console","joinMeeting","JOIN_MEETING","joinurl","meetingidnotexists","endMeeting","value","target","END_MEETING","deleted","clearMainSection"],"mappings":"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"}