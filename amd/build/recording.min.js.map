{"version":3,"file":"recording.min.js","sources":["../src/recording.js"],"sourcesContent":["/* eslint-disable */\n\nimport { ACTIONS_AJAX_RECORDING } from \"./lib/actions\";\nimport { TEMPLATES, renderTemplate } from \"./lib/template\";\n\nM.mod_tutoom = M.mod_tutoom || {};\n\nexport const joinPlayback = async (e) => {\n  e.preventDefault();\n\n  const tutoom = window.tutoom;\n  if (!tutoom || tutoom === undefined) throw new Error(\"Tutoom data is empty\");\n\n  const { baseUrl, id: ID } = tutoom;\n\n  const { meetingid } = e.target.dataset;\n\n  try {\n    const url = `${baseUrl}?action=${ACTIONS_AJAX_RECORDING.JOIN_PLAYBACK}&sesskey=${M.cfg.sesskey}&id=${ID}&meetingId=${meetingid}`;\n    const fetch = await window.fetch(url);\n    const { joinurl } = await fetch.json();\n\n    window.location.href = joinurl;\n  } catch (error) {\n    console.error(error);\n  }\n};\n\nexport const getRecordings = async ({ page = 1, isFirstTime = false }) => {\n  const tutoom = window.tutoom;\n  if (!tutoom || tutoom === undefined) throw new Error(\"Tutoom data is empty\");\n\n  const { baseUrl, id: ID, countRecordings, limitRecordings } = tutoom;\n\n  const elementRecordingTableContent = document.getElementById(\n    \"tutoom-recordings-table-content\"\n  );\n  const elementRecordingLoader = document.getElementById(\n    \"tutoom_view_recordings_loading\"\n  );\n\n  try {\n    // Show loader recordings.\n    if (!isFirstTime) {\n      elementRecordingTableContent.innerHTML = \"\";\n      elementRecordingLoader.style.display = \"flex\";\n    }\n\n    const url = `${baseUrl}?action=${ACTIONS_AJAX_RECORDING.GET_RECORDINGS}&sesskey=${M.cfg.sesskey}&id=${ID}&page=${page}`;\n    const fetch = await window.fetch(url);\n    const { data } = await fetch.json();\n\n    const recordings = data.map((r, index) => {\n      const isLastIndex = index === data.length - 1;\n      const renderRowSeparator = !isLastIndex;\n      const { RecordingId, Duration, CreationTimestamp, MeetingId, Thumbnail } =\n        r;\n\n      const language = window.navigator.language;\n\n      const seconds = Duration;\n      const hours = Math.floor(seconds / 3600);\n      const minutes = Math.floor((seconds % 3600) / 60) + \"min\";\n\n      const duration = hours > 0 ? `${hours}h ${minutes}` : minutes;\n\n      const date = new Date(CreationTimestamp).toLocaleString(language, {\n        month: \"short\",\n        day: \"numeric\",\n        year: \"numeric\",\n      });\n      const time = new Date(CreationTimestamp).toLocaleString(language, {\n        hour: \"numeric\",\n        minute: \"numeric\",\n        hour12: true,\n      });\n\n      return {\n        recordingId: RecordingId,\n        thumbnail: Thumbnail,\n        duration,\n        date,\n        time,\n        renderRowSeparator,\n        meetingid: MeetingId,\n      };\n    });\n\n    const callbackBeforeRender = () => {\n      elementRecordingLoader.style.display = \"none\";\n    };\n\n    const callbackAfterRender = () => {\n      const thumbnails = document.querySelectorAll(\".thumbnail\");\n      thumbnails.forEach((thumbnail) => {\n        thumbnail.addEventListener(\"click\", joinPlayback);\n      });\n    };\n\n    await renderTemplate({\n      data: { recordings },\n      type: TEMPLATES.RECORDING_TABLE_CONTENT,\n      callbackBeforeRender,\n      callbackAfterRender,\n    });\n\n    const totalPages = Math.ceil(countRecordings / limitRecordings);\n    const pages = [...Array(totalPages).keys()].map((n) => ({\n      number: n + 1,\n      isSelected: n + 1 === page,\n    }));\n\n    const currentPage = pages.findIndex((p) => p.isSelected) + 1;\n\n    if (totalPages > 1) {\n      const dataPagination = {\n        pages,\n        disablePrevious: page === 1,\n        disableNext: page === totalPages,\n        currentPage,\n      };\n\n      renderTemplate({\n        data: dataPagination,\n        type: TEMPLATES.RECORDING_PAGINATION,\n      });\n    }\n  } catch (error) {\n    console.error(error);\n  }\n};\n"],"names":["M","mod_tutoom","joinPlayback","e","preventDefault","tutoom","window","undefined","Error","baseUrl","ID","id","meetingid","target","dataset","url","ACTIONS_AJAX_RECORDING","JOIN_PLAYBACK","cfg","sesskey","fetch","json","joinurl","location","href","console","error","getRecordings","page","isFirstTime","countRecordings","limitRecordings","elementRecordingTableContent","document","getElementById","elementRecordingLoader","innerHTML","style","display","GET_RECORDINGS","data","recordings","map","r","index","renderRowSeparator","length","RecordingId","Duration","CreationTimestamp","MeetingId","Thumbnail","language","navigator","seconds","hours","Math","floor","minutes","recordingId","thumbnail","duration","date","Date","toLocaleString","month","day","year","time","hour","minute","hour12","callbackBeforeRender","callbackAfterRender","querySelectorAll","forEach","addEventListener","type","TEMPLATES","RECORDING_TABLE_CONTENT","totalPages","ceil","pages","_toConsumableArray","Array","keys","n","number","isSelected","currentPage","findIndex","p","dataPagination","disablePrevious","disableNext","RECORDING_PAGINATION"],"mappings":"kqDAKAA,EAAEC,WAAaD,EAAEC,YAAc,YAElBC,8DAAe,iBAAOC,+KACjCA,EAAEC,kBAEIC,OAASC,OAAOD,cACIE,IAAXF,oCAA4B,IAAIG,MAAM,sCAE7CC,QAAoBJ,OAApBI,QAAaC,GAAOL,OAAXM,GAETC,UAAcT,EAAEU,OAAOC,QAAvBF,0BAGAG,cAASN,2BAAkBO,gCAAuBC,kCAAyBjB,EAAEkB,IAAIC,uBAAcT,yBAAgBE,4BACjGN,OAAOc,MAAML,oBAA3BK,qCACoBA,MAAMC,+CAAxBC,0BAAAA,QAERhB,OAAOiB,SAASC,KAAOF,sFAEvBG,QAAQC,wLAICC,gEAAgB,+aAASC,KAAAA,yBAAO,qCAAGC,YAAAA,2DACxCxB,OAASC,OAAOD,cACIE,IAAXF,qCAA4B,IAAIG,MAAM,sCAE7CC,QAAsDJ,OAAtDI,QAAaC,GAAyCL,OAA7CM,GAAQmB,gBAAqCzB,OAArCyB,gBAAiBC,gBAAoB1B,OAApB0B,gBAEpCC,6BAA+BC,SAASC,eAC5C,mCAEIC,uBAAyBF,SAASC,eACtC,mDAKKL,cACHG,6BAA6BI,UAAY,GACzCD,uBAAuBE,MAAMC,QAAU,QAGnCvB,cAASN,2BAAkBO,gCAAuBuB,mCAA0BvC,EAAEkB,IAAIC,uBAAcT,oBAAWkB,wBAC7FtB,OAAOc,MAAML,oBAA3BK,uCACiBA,MAAMC,wDAArBmB,wBAAAA,KAEFC,WAAaD,KAAKE,KAAI,SAACC,EAAGC,WAExBC,qBADcD,QAAUJ,KAAKM,OAAS,GAEpCC,YACNJ,EADMI,YAAaC,SACnBL,EADmBK,SAAUC,kBAC7BN,EAD6BM,kBAAmBC,UAChDP,EADgDO,UAAWC,UAC3DR,EAD2DQ,UAGvDC,SAAW9C,OAAO+C,UAAUD,SAE5BE,QAAUN,SACVO,MAAQC,KAAKC,MAAMH,QAAU,MAC7BI,QAAUF,KAAKC,MAAOH,QAAU,KAAQ,IAAM,YAe7C,CACLK,YAAaZ,YACba,UAAWT,UACXU,SAhBeN,MAAQ,YAAOA,mBAAUG,SAAYA,QAiBpDI,KAfW,IAAIC,KAAKd,mBAAmBe,eAAeZ,SAAU,CAChEa,MAAO,QACPC,IAAK,UACLC,KAAM,YAaNC,KAXW,IAAIL,KAAKd,mBAAmBe,eAAeZ,SAAU,CAChEiB,KAAM,UACNC,OAAQ,UACRC,QAAQ,IASR1B,mBAAAA,mBACAjC,UAAWsC,cAITsB,qBAAuB,WAC3BrC,uBAAuBE,MAAMC,QAAU,QAGnCmC,oBAAsB,WACPxC,SAASyC,iBAAiB,cAClCC,SAAQ,SAACf,WAClBA,UAAUgB,iBAAiB,QAAS1E,qCAIlC,4BAAe,CACnBsC,KAAM,CAAEC,WAAAA,YACRoC,KAAMC,oBAAUC,wBAChBP,qBAAAA,qBACAC,oBAAAA,8BAGIO,WAAaxB,KAAKyB,KAAKnD,gBAAkBC,iBACzCmD,MAAQC,mBAAIC,MAAMJ,YAAYK,QAAQ3C,KAAI,SAAC4C,SAAO,CACtDC,OAAQD,EAAI,EACZE,WAAYF,EAAI,IAAM1D,SAGlB6D,YAAcP,MAAMQ,WAAU,SAACC,UAAMA,EAAEH,cAAc,EAEvDR,WAAa,IACTY,eAAiB,CACrBV,MAAAA,MACAW,gBAA0B,IAATjE,KACjBkE,YAAalE,OAASoD,WACtBS,YAAAA,0CAGa,CACbjD,KAAMoD,eACNf,KAAMC,oBAAUiB,0GAIpBtE,QAAQC"}